!function(m){function c(e){if("string"==typeof e){var t=e.indexOf("_");-1!=t&&(e=e.substr(t+1))}return e}function v(e,t){if("string"==typeof e&&-1!=e.indexOf(t))return!0;return!1}var f=[],S=0,t={init:function(e){var c={lensShape:"square",lensSize:[100,100],borderSize:4,borderColor:"#888",borderRadius:0,imgSrc:"",imgSrc2x:"",lensCss:"",imgOverlay:"",overlayAdapt:!0,zoomLevel:1,responsive:!0},g=m.extend({},c,e),p="100px",h="100px";if(v(g.lensSize,",")){var t=g.lensSize.indexOf(","),i=[];i[0]=g.lensSize.substring(0,t),i[1]=g.lensSize.substring(t+1),g.lensSize=i}this.each(function(){var i=m(this),e=i.data("mlens"),t=m(),n=m(),r=m(),o=m(),a=i.attr("src"),s="auto";("number"!=typeof g.zoomLevel||g.zoomLevel<=0)&&(g.zoomLevel=c.zoomLevel);var d=new Image;""!==g.imgSrc2x&&1<window.devicePixelRatio?(a=g.imgSrc2x,d.onload=function(){s=String(parseInt(this.width/2)*g.zoomLevel)+"px",t.css({backgroundSize:s+" auto"}),o.css({width:s})}):(""!==g.imgSrc&&(a=g.imgSrc),d.onload=function(){s=String(parseInt(this.width)*g.zoomLevel)+"px",t.css({backgroundSize:s+" auto"}),o.css({width:s})}),d.src=a,h=!0===jQuery.isArray(g.lensSize)?(p=v(g.lensSize[0],"%")||v(g.lensSize[0],"px")?String(g.lensSize[0]):String(g.lensSize[0])+"px",v(g.lensSize[1],"%")||v(g.lensSize[1],"px")?String(g.lensSize[1]):String(g.lensSize[1])+"px"):p=v(g.lensSize,"%")||v(g.lensSize,"px")?String(g.lensSize):String(g.lensSize)+"px";var l="background-position: 0px 0px;width: "+p+";height: "+h+";float: left;display: none;border: "+String(g.borderSize)+"px solid "+g.borderColor+";background-repeat: no-repeat;position: absolute;",u="position: absolute; width: 100%; height: 100%; left: 0; top: 0; background-position: center center; background-repeat: no-repeat; z-index: 1;";switch(!0===g.overlayAdapt&&(u+="background-position: center center fixed; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover;"),g.lensShape){case"square":case"":l=l+"border-radius:"+String(g.borderRadius)+"px;",u=u+"border-radius:"+String(g.borderRadius)+"px;";break;case"circle":l+="border-radius: 50%;",u+="border-radius: 50%;";break;default:l=l+"border-radius:"+String(g.borderRadius)+"px;",u=u+"border-radius:"+String(g.borderRadius)+"px;"}return i.wrap("<div id='mlens_wrapper_"+S+"' />"),r=i.parent(),!0===g.responsive?i.css({width:"100%"}):r.css({width:i.width()}),(t=m("<div id='mlens_target_"+S+"' style='"+l+"' class='"+g.lensCss+"'>&nbsp;</div>").appendTo(r)).css({backgroundImage:"url('"+a+"')",backgroundSize:s+" auto",cursor:"none"}),o=m("<img style='display:none;width:"+s+";height:auto;max-width:none;max-height;none;' src='"+a+"' />").appendTo(r),""!==g.imgOverlay&&((n=m("<div id='mlens_overlay_"+S+"' style='"+u+"'>&nbsp;</div>")).css({backgroundImage:"url('"+g.imgOverlay+"')",cursor:"none"}),n.appendTo(t)),i.attr("data-id","mlens_"+S),t.mousemove(function(e){m.fn.mlens("move",i.attr("data-id"),e)}),i.mousemove(function(e){m.fn.mlens("move",i.attr("data-id"),e)}),t.on("touchmove",function(e){e.preventDefault();var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];m.fn.mlens("move",i.attr("data-id"),t)}),i.on("touchmove",function(e){e.preventDefault();var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];m.fn.mlens("move",i.attr("data-id"),t)}),t.hover(function(){m(this).show()},function(){m(this).hide()}),i.hover(function(){t.show()},function(){t.hide()}),t.on("touchstart",function(e){e.preventDefault(),m(this).show()}),t.on("touchend",function(e){e.preventDefault(),m(this).hide()}),i.on("touchstart",function(e){e.preventDefault(),t.show()}),i.on("touchend",function(e){e.preventDefault(),t.hide()}),i.data("mlens",{image:i,settings:g,target:t,imageTag:o,imgSrc:a,imgWidth:s,imageWrapper:r,overlay:n,instance:S,lensSizeHoriz:p,lensSizeVert:h}),e=i.data("mlens"),f[S]=e,S++,f})},move:function(e,t){e=c(e);var i=f[e],n=i.image,r=i.target,o=i.imageTag,a=n.offset(),s=parseInt(t.pageX-a.left),d=parseInt(t.pageY-a.top),l=o.width()/n.width(),u=o.height()/n.height();return 0<s&&0<d&&s<n.width()&&d<n.height()&&(s=String(-((t.pageX-a.left)*l-r.width()/2)),d=String(-((t.pageY-a.top)*u-r.height()/2)),r.css({backgroundPosition:s+"px "+d+"px"}),s=String(t.pageX-a.left-r.width()/2),d=String(t.pageY-a.top-r.height()/2),r.css({left:s+"px",top:d+"px"})),i.target=r,f[e]=i,f},update:function(e){m(this).mlens("destroy"),m(this).mlens("init",e)},destroy:function(){var e=c(m(this).attr("data-id")),t=f[e];t.target.remove(),t.imageTag.remove(),t.image.unwrap(),t.overlay.remove(),m.removeData(t,"mlens"),this.unbind(),this.element=null}};m.fn.mlens=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void m.error("Method "+e+" does not exist on jQuery.mlens"):t.init.apply(this,arguments)}}(jQuery);